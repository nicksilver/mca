import numpy as np
from rasterstats import zonal_stats
from netCDF4 import Dataset
from affine import Affine

shp_path = "/home/nick/workspace/shapefiles/MT_CLIM_DIVISIONS.shp"
fn = "maca_v2_metdata_pr_NorESM1-M_rcp85_r1i1p1_2040_2069_SILVERMAN_daily_MT.nc"
net_path = "/data/maca_mt/" + fn 

net_data = Dataset(net_path)
data = net_data.variables['precipitation'][0, :, :]

# Affine transformation information:
# a = width of a pixel
# b = row rotation (typically zero)
# c = x-coordinate of the upper-left corner of the upper-left pixel
# d = column rotation (typically zero)
# e = height of a pixel (typically negative)
# f = y-coordinate of the of the upper-left corner of the upper-left pixel

a = float(getattr(net_data, "geospatial_lon_resolution"))
b = 0
c = float(getattr(net_data, "geospatial_lon_min")) - a
d = 0
e = -float(getattr(net_data, "geospatial_lat_resolution"))
f = float(getattr(net_data, "geospatial_lat_max")) - e 

aff = Affine(a, b, c, d, e, f)

zs = zonal_stats(shp_path, data, affine=aff)
